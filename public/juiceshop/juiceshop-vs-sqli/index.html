<!doctype html>
<html lang="en-us">
  <head>
    <title>JuiceShop vs SQLI // Oshikuru&#39;s blog</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.112.1">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="the-witcher-3-wild-hunt.jpg" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="/blog/css/main.min.3c3c186cd62e563ad6e2f00a89dbee656ab912d1d46f856b5605dd0232521e2a.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="JuiceShop vs SQLI"/>
<meta name="twitter:description" content="Intro In this blog I will be exploring OWASP Juice Shop using SQL injection techniques, exploring various enumeration methods, and solving the SQL challenges.
Any time there is a search bar, or area a user can imput text on a web application there exists the potential for sql injection. This makes it very important to handle all possible edege cases so that someone does not accidentally, or intentionally break your application."/>

    <meta property="og:title" content="JuiceShop vs SQLI" />
<meta property="og:description" content="Intro In this blog I will be exploring OWASP Juice Shop using SQL injection techniques, exploring various enumeration methods, and solving the SQL challenges.
Any time there is a search bar, or area a user can imput text on a web application there exists the potential for sql injection. This makes it very important to handle all possible edege cases so that someone does not accidentally, or intentionally break your application." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jjolley91.github.io/blog/juiceshop/juiceshop-vs-sqli/" /><meta property="article:section" content="JuiceShop" />
<meta property="article:published_time" content="2023-05-25T13:20:30-05:00" />
<meta property="article:modified_time" content="2023-05-25T13:20:30-05:00" />


  </head>
  <body>
    <header class="app-header">
      <a href="https://jjolley91.github.io/blog/"><img class="app-header-avatar" src="/blog/the-witcher-3-wild-hunt.jpg" alt="the-witcher-3-wild-hunt.jpg" /></a>
      <span class="app-header-title">Oshikuru&#39;s blog</span>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vehicula turpis sit amet elit pretium.</p>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">JuiceShop vs SQLI</h1>
      <div class="post-meta">
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          May 25, 2023
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          4 min read
        </div>
        <div>
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7.01" y2="7"></line>
</svg>
              <a class="tag" href="https://jjolley91.github.io/blog/tags/sqli/">SQLI</a>
              <a class="tag" href="https://jjolley91.github.io/blog/tags/writeups/">Writeups</a>
              <a class="tag" href="https://jjolley91.github.io/blog/tags/juiceshop/">JuiceShop</a>
        </div>
      </div>
    </header>
    <div class="post-content">
      <h1 id="intro">Intro</h1>
<p>In this blog I will be exploring OWASP Juice Shop using SQL injection techniques, exploring various enumeration methods, and solving the SQL challenges.</p>
<p>Any time there is a search bar, or area a user can imput text on a web application there exists the potential for sql injection. This makes it very important to handle all possible edege cases so that someone does not accidentally, or intentionally break your application.</p>
<h3 id="logging-in-as-admin-using-sql-injection">Logging in as Admin using SQL Injection:</h3>
<h4 id="difficulty-trivial">Difficulty: Trivial</h4>
<p><img src="https://github.com/jjolley91/blog/blob/main/static/sqli/sql_login.png?raw=true" alt="sql_login"></p>
<blockquote>
<p>email: &lsquo;or 1=1&ndash;</p>
</blockquote>
<blockquote>
<p>password: something</p>
</blockquote>
<p>The reason this workes is due to improper imput sanitization before the query is sent to the sql db. Normally the program would be doing something like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-SQL" data-lang="SQL"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> user_id <span style="color:#66d9ef">FROM</span> users_table <span style="color:#66d9ef">WHERE</span> email_address <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;some@valid.email&#39;</span>  <span style="color:#66d9ef">AND</span> password <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;saved_password&#39;</span>;
</span></span></code></pre></div><p>However, without being properly handled the query itself can be manipulated so instead of checking if the email is valid and then matching the password in the database, we escaped the query with the single quote, then added a statement which will always evaluate to &lsquo;True&rsquo;.
We end up with the query:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-SQL" data-lang="SQL"><span style="display:flex;"><span><span style="color:#66d9ef">SELECT</span> user_id <span style="color:#66d9ef">FROM</span> users_table <span style="color:#66d9ef">WHERE</span> email_address <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span> <span style="color:#66d9ef">OR</span> <span style="color:#ae81ff">1</span><span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#75715e">--&#39; 
</span></span></span></code></pre></div><p>Thus we end up canceling the original query and the system just returns the first user in the database, which is usually an admin account! Pretty neat!</p>
<h3 id="defense-and-remediation">Defense and remediation:</h3>
<p>As stated above this can be easily remediated using prepared statements with variable binding. All this amounts to is a simple change in the way the query is handled on the backend.</p>
<h4 id="example">Example:</h4>
<p>Instead of something like this vulnerable java example:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-SQL" data-lang="SQL"><span style="display:flex;"><span>String query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT email FROM users WHERE email = &#34;</span>
</span></span><span style="display:flex;"><span>             <span style="color:#f92672">+</span> request.getParameter(<span style="color:#e6db74">&#34;customerName&#34;</span>);
</span></span><span style="display:flex;"><span>try <span style="color:#960050;background-color:#1e0010">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">Statement</span> <span style="color:#66d9ef">statement</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">connection</span>.createStatement( ... );
</span></span><span style="display:flex;"><span>    ResultSet results <span style="color:#f92672">=</span> <span style="color:#66d9ef">statement</span>.executeQuery( query );
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-SQL" data-lang="SQL"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>String custname <span style="color:#f92672">=</span> request.getParameter(<span style="color:#e6db74">&#34;customerName&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#f92672">//</span> Perform <span style="color:#66d9ef">input</span> validation <span style="color:#66d9ef">to</span> detect attacks
</span></span><span style="display:flex;"><span>String query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;SELECT email FROM users WHERE email = ? &#34;</span>;
</span></span><span style="display:flex;"><span>PreparedStatement pstmt <span style="color:#f92672">=</span> <span style="color:#66d9ef">connection</span>.prepareStatement( query );
</span></span><span style="display:flex;"><span>pstmt.setString( <span style="color:#ae81ff">1</span>, custname);
</span></span><span style="display:flex;"><span>ResultSet results <span style="color:#f92672">=</span> pstmt.executeQuery( );
</span></span></code></pre></div><h3 id="christmas-special">Christmas Special</h3>
<h3 id="difficulty-moderate">Difficulty: Moderate</h3>
<p>The site uses the /sqli/#/sqli/search when searching the site from the search bar. What comes after the hash(#) is called a fragment. I will not go to deep into why, but essentialy this is just identifying a part of the page, which keeps the query confined to the client side.</p>
<p>The first part of the challenge here is identifying a different way to use the search so that we are able to perform the sql injection.</p>
<p>I used BurpSuite for most of this but I will also note that you can find the same directory by using the devtools &lt; network tab&lt; and searching for &lsquo;search&rsquo;</p>
<p><img src="https://github.com/jjolley91/blog/blob/main/static/sqli/4dev_tools_method.png?raw=true" alt="dev_tools_method"></p>
<blockquote>
<p>Note: all of the following sql queries can also be done directly from the address bar, but I will be using burp repeater.</p>
</blockquote>
<p>First, I fired up BurpSuite, and added the ip address for juice shop to the scope list:</p>
<p><img src="https://github.com/jjolley91/blog/blob/main/static/sqli//1_scope.png?raw=true" alt="1_scope"></p>
<p>Next, I enabled FoxyProxy and simply refreshed the page to trigger burp to begin mapping the site.</p>
<p><img src="https://github.com/jjolley91/blog/blob/main/static/sqli/2site_map.png?raw=true" alt="2site_map"></p>
<p>Here you can see the GET request /sqli/rest/sqli/products/sqli/search which I sent to the repeater to start testing for the sql injection potential.</p>
<p><img src="https://github.com/jjolley91/blog/blob/main/static/sqli/3send_to_repeater.png?raw=true" alt="3send_to_repeater"></p>
<p>Here you can see that with the first attempt, the server returns an error message!</p>
<p><img src="https://github.com/jjolley91/blog/blob/main/static/sqli/5first_injection.png?raw=true" alt="5first_injection"></p>
<p>This is a very good sign since it tells me that the server is using SQLite, and also that the query did reach the database!</p>
<p>Now I can coninue the injection attack.</p>
<blockquote>
<p>Note: the &lsquo;; resulted in an error due to the original query not being ended properly.</p>
</blockquote>
<p>To remediate this is just a matter of determining how many ) were used in the original query</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-SQL" data-lang="SQL"><span style="display:flex;"><span><span style="color:#e6db74">&#39;))--
</span></span></span></code></pre></div><p>The &lsquo;)) is used to end the query, and the &ndash; turns the rest of the query into a comment and will be ignored now by the SQL DB.</p>
<p>This does the trick and returns the entire table of products!</p>
<p><img src="https://github.com/jjolley91/blog/blob/main/static/sqli/6returned_table.png?raw=true" alt="6returned_table"></p>
<p>Since the challenge mentions &lsquo;Christmas&rsquo; I just searched for christmas within the response and noted the ID:10</p>
<p><img src="https://github.com/jjolley91/blog/blob/main/static/sqli/7christmas_id.png?raw=true" alt="7christmas_id"></p>
<p>I then intercepted the traffic and changed the product id to 10.</p>
<p><img src="https://github.com/jjolley91/blog/blob/main/static/sqli/9mod_basket.png?raw=true" alt="9mod_basket"></p>
<p>This still did not complete the challenge however, I realized I needed to actually checkout to place the order. Once I did that the challenge was complete!</p>
<h3 id="database-schema">Database Schema</h3>
<h4 id="difficulty-easy">Difficulty: Easy</h4>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
